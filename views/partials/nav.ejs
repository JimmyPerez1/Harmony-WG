<%
  const overlay = (typeof navVariant !== 'undefined' ? navVariant : 'solid') === 'overlay';
%>

<nav id="site-nav"
     data-overlay="<%= overlay ? '1' : '0' %>"
     class="<%= overlay ? 'absolute bg-transparent text-white' : 'fixed solid text-white shadow-md' %> top-0 left-0 w-full z-50">

  <!-- Solid theme colors (non-home) -->
  <style>
    #site-nav.solid { background-color:#065f46 !important; color:#ffffff !important; }
    #site-nav.solid a { color:#ffffff !important; }
    #site-nav.solid a:hover { color:#bbf7d0 !important; }
    #site-nav.solid svg { stroke:#ffffff !important; }
  </style>

  <div class="mx-auto max-w-6xl px-6 h-16 flex items-center justify-between">
    <!-- Brand -->
    <a href="/" class="flex items-center gap-2">
      <img src="/harmony_logo.png" alt="Harmony Wellness Group Logo" class="w-10 h-10 object-contain"/>
      <span class="text-lg md:text-xl font-bold tracking-wide">Harmony Wellness Group</span>
    </a>

    <!-- Desktop menu -->
    <div class="hidden md:flex items-center gap-6">
      <a href="/services" class="hover:text-green-200"><%= (typeof lang !== 'undefined' && lang==='es') ? 'Servicios' : 'Services' %></a>
      <a href="/about" class="hover:text-green-200"><%= (typeof lang !== 'undefined' && lang==='es') ? 'Acerca de' : 'About' %></a>
      <a href="/request-appointment" class="hover:text-green-200"><%= (typeof lang !== 'undefined' && lang==='es') ? 'Solicitar Cita' : 'Request an Appointment' %></a>

      <!-- Language toggle (desktop) -->
      <button id="lang-btn-desktop"
              class="inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-white/10 hover:bg-white/20
                     focus:outline-none focus:ring-2 focus:ring-white/50"
              type="button" aria-label="Language">
        <span id="lang-flag-d"><%= (typeof lang !== 'undefined' && lang==='es') ? 'ðŸ‡ªðŸ‡¸' : 'ðŸ‡ºðŸ‡¸' %></span>
        <span id="lang-code-d"><%= (typeof lang !== 'undefined' && lang==='es') ? 'ES' : 'EN' %></span>
      </button>
    </div>

    <!-- Mobile toggle -->
    <button id="nav-btn"
            class="md:hidden inline-flex items-center justify-center p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/50"
            aria-controls="nav-panel" aria-expanded="false" aria-label="Toggle menu" type="button">
      <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>
  </div>
  <!-- Mobile dropdown (always a green background) -->
  <div id="nav-panel"
       class="hidden md:hidden fixed top-16 left-0 w-full text-white shadow-lg z-[60]">
    <div class="mx-auto max-w-6xl px-6 py-4 flex flex-col">
      <a href="/services" class="py-3 border-b border-white/10 hover:text-green-200">
        <%= (typeof lang !== 'undefined' && lang==='es') ? 'Servicios' : 'Services' %>
      </a>
      <a href="/about" class="py-3 border-b border-white/10 hover:text-green-200">
        <%= (typeof lang !== 'undefined' && lang==='es') ? 'Acerca de' : 'About' %>
      </a>
      <a href="/request-appointment" class="py-3 hover:text-green-200">
        <%= (typeof lang !== 'undefined' && lang==='es') ? 'Solicitar Cita' : 'Request an Appointment' %>
      </a>

      <!-- Mobile language buttons -->
      <div class="border-t border-white/10 mt-3 pt-3">
        <div class="text-white/80 text-xs mb-1">
          <%= (typeof lang !== 'undefined' && lang==='es') ? 'Idioma' : 'Language' %>
        </div>
        <div class="flex gap-2">
          <button data-lang="en" class="px-3 py-2 rounded-md bg-white/10 hover:bg-white/20">ðŸ‡ºðŸ‡¸ EN</button>
          <button data-lang="es" class="px-3 py-2 rounded-md bg-white/10 hover:bg-white/20">ðŸ‡ªðŸ‡¸ ES</button>
        </div>
      </div>
    </div>
  </div>

</nav>


  <!-- Force the dropdown background (solid on inner pages, translucent on home/overlay) -->
  <style>
    /* Inner pages (solid) */
    #site-nav.solid #nav-panel { background-color: #065f46 !important; } /* emerald-800 */

    /* Home overlay (tinted + slight blur) */
    #site-nav[data-overlay="1"] #nav-panel {
      background-color: rgba(6,95,70,0.95) !important; /* emerald-800 @ 95% */
      backdrop-filter: saturate(120%) blur(2px);
    }
  </style>

<% if (!overlay) { %><div id="nav-spacer" class="h-16"></div><% } %>
<div id="nav-backdrop" class="hidden fixed inset-0 bg-black/50 z-40 md:hidden"></div>

<script>
(function(){
  // Mobile menu
  var btn = document.getElementById('nav-btn');
  var panel = document.getElementById('nav-panel');
  var backdrop = document.getElementById('nav-backdrop');
  function openMenu(){ panel.classList.remove('hidden'); backdrop.classList.remove('hidden'); btn.setAttribute('aria-expanded','true'); document.body.style.overflow='hidden'; }
  function closeMenu(){ panel.classList.add('hidden'); backdrop.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); document.body.style.overflow=''; }
  if (btn && panel){ btn.addEventListener('click', function(){ panel.classList.contains('hidden') ? openMenu() : closeMenu(); }); }
  if (backdrop){ backdrop.addEventListener('click', closeMenu); }
  if (panel){ panel.addEventListener('click', function(e){ if (e.target.closest('a')) closeMenu(); }); }

  // Overlay tint on scroll (home only)
  var nav = document.getElementById('site-nav');
  if (nav && nav.getAttribute('data-overlay') === '1'){
    function tint(){
      if (window.scrollY > 20){ nav.classList.remove('bg-transparent'); nav.classList.add('bg-emerald-900/70','backdrop-blur-md'); }
      else { nav.classList.add('bg-transparent'); nav.classList.remove('bg-emerald-900/70','backdrop-blur-md'); }
    }
    window.addEventListener('scroll', tint); tint();
  }

  // Language cookie + reload
  function setLang(lang){ document.cookie='lang='+(lang==='es'?'es':'en')+'; path=/; max-age=31536000'; location.reload(); }
  document.getElementById('lang-btn-desktop')?.addEventListener('click', function(){
    var current = document.cookie.split('; ').find(r=>r.startsWith('lang='))?.split('=')[1] || 'en';
    setLang(current === 'es' ? 'en' : 'es');
  });
  document.querySelectorAll('[data-lang]').forEach(function(b){ b.addEventListener('click', function(){ setLang(b.dataset.lang); }); });
})();
</script>